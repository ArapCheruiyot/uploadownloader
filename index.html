<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive File Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* Add your CSS here */
    </style>
</head>
<body>
    <header>
        <h1>Google Drive File Manager</h1>
    </header>
    <main>
        <button id="authButton">Authorize Google Drive</button>
        <button id="listFilesButton" disabled>List Google Drive Files</button>

        <section id="fileListSection">
            <h2>Files on Google Drive</h2>
            <ul id="fileList"></ul>
        </section>

        <section id="searchSection">
            <h2>Search File Content</h2>
            <input type="text" id="searchInput" placeholder="Enter search term">
            <button id="searchButton" disabled>Search</button>
            <div id="resultContainer"></div>
        </section>
    </main>

    <script>
        let gapiInited = false;
        let accessToken;
        const CLIENT_ID = '361306676979-daeqed946lct73e84fu6t16i38u2ialv.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY';
        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

        // Load the GAPI client
        function gapiLoaded() {
            gapi.load('client:auth2', initializeGAPI);
        }

        async function initializeGAPI() {
            await gapi.client.init({ apiKey: API_KEY, clientId: CLIENT_ID, scope: SCOPES });
            document.getElementById('authButton').onclick = handleAuthClick;
            document.getElementById('listFilesButton').onclick = listFiles;
        }

        async function handleAuthClick() {
            try {
                const googleUser = await gapi.auth2.getAuthInstance().signIn();
                accessToken = googleUser.getAuthResponse().access_token;
                document.getElementById('listFilesButton').disabled = false;
                alert('Authentication successful!');
            } catch (error) {
                console.error('Error during authentication', error);
            }
        }

        async function listFiles() {
            try {
                const response = await gapi.client.drive.files.list({
                    pageSize: 10,
                    fields: 'files(id, name)',
                });
                const files = response.result.files;
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';
                files.forEach(file => {
                    const li = document.createElement('li');
                    li.textContent = `${file.name} (${file.id})`;
                    li.dataset.fileId = file.id;
                    li.onclick = () => downloadFile(file.id, file.name);
                    fileList.appendChild(li);
                });
            } catch (error) {
                console.error('Error listing files', error);
            }
        }

        async function downloadFile(fileId, fileName) {
            try {
                const response = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media',
                });
                const data = response.body;
                parseExcelFile(data, fileName);
            } catch (error) {
                console.error('Error downloading file', error);
            }
        }

        function parseExcelFile(data, fileName) {
            const workbook = XLSX.read(data, { type: 'binary' });
            let allData = [];
            workbook.SheetNames.forEach(sheetName => {
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], { header: 1 });
                allData = allData.concat(rows);
            });
            document.getElementById('searchButton').disabled = false;
            document.getElementById('searchButton').onclick = () => searchInFile(allData);
        }

        function searchInFile(data) {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = '';

            const results = data.filter(row => row.some(cell => String(cell).includes(searchTerm)));
            if (results.length > 0) {
                results.forEach(row => {
                    const div = document.createElement('div');
                    div.textContent = row.join(', ');
                    resultContainer.appendChild(div);
                });
            } else {
                resultContainer.textContent = 'No results found.';
            }
        }

        document.addEventListener('DOMContentLoaded', gapiLoaded);
    </script>
</body>
</html>
